---
title: "Réponse aux TD  \n data visualisation"
author: "Laurent Politis"
date: "21 février 2017"
output: pdf_document
---


## Exercice 1

Nous avons vu plusieurs modèles la dernière fois pour modéliser la vitesse et la distance de freinage en fonction des différentes métriques d'erreurs présentées au-dessus. Séléctionner le modèle satistique le plus pertinant en modifiant `ma_formule`.

**Réponse**

Le meilleur modèle est celui qui maximise le $R^2$ et minimise les critères d'informations Bayésien et d'Akaike.

```{r, fig.show='hold',echo=FALSE,out.width='50%'}
library(ggplot2)
library(ggpmisc)


ma_formule = y ~ poly(x = x,degree =2)

ggplot(cars,aes(x=speed,y=dist)) + geom_point(aes(colour=speed<15)) + geom_smooth(method = "lm",formula = ma_formule ) +  stat_poly_eq(aes(label =paste0("atop(",..eq.label..,",",paste(..adj.rr.label..,..AIC.label..,..BIC.label..,sep="~"),")")),formula =ma_formule, parse = TRUE) + theme(plot.subtitle = element_text(vjust = 1), 
    plot.caption = element_text(vjust = 1), 
    plot.background = element_rect(fill = "white", 
        colour = "red", size = 3, linetype = "solid")) 

ma_formule = y ~x

ggplot(cars,aes(x=speed,y=dist)) + geom_point(aes(colour=speed<15)) + geom_smooth(method = "lm",formula = ma_formule ) +  stat_poly_eq(aes(label =paste0("atop(",..eq.label..,",",paste(..adj.rr.label..,..AIC.label..,..BIC.label..,sep="~"),")")),formula =ma_formule, parse = TRUE)

```
```{r, fig.show='hold',echo=FALSE,out.width='50%'}

ma_formule = y ~ poly(x = x,degree =3)

ggplot(cars,aes(x=speed,y=dist)) + geom_point(aes(colour=speed<15)) + geom_smooth(method = "lm",formula = ma_formule ) +  stat_poly_eq(aes(label =paste0("atop(",..eq.label..,",",paste(..adj.rr.label..,..AIC.label..,..BIC.label..,sep="~"),")")),formula =ma_formule, parse = TRUE)

ma_formule =  y ~ poly(x = x,degree =4)


ggplot(cars,aes(x=speed,y=dist)) + geom_point(aes(colour=speed<15)) + geom_smooth(method = "lm",formula = ma_formule ) +  stat_poly_eq(aes(label =paste0("atop(",..eq.label..,",",paste(..adj.rr.label..,..AIC.label..,..BIC.label..,sep="~"),")")),formula =ma_formule, parse = TRUE)

```


## Exercice 2


* **Quelle est le type de cet objet ?**
 
```{r}
class(mpg)
```
L'objet est une `data.frame.`


* **Que contient cet objet ? **


```{r,eval=FALSE}
?mpg

```
<!-- ![Résulat de la commande ?mpg](/home/mrrobot/Pictures/help_mpg.png) -->


This dataset contains a subset of the fuel economy data that the EPA makes available on http://fueleconomy.gov. It contains only models which had a new release every year between 1999 and 2008 - this was used as a proxy for the popularity of the car.



```{r}
head(mpg)
```


* **Que siginifie `displ` et `hwy` ?**

*displ*

engine displacement, in litres

*hwy*

highway miles per gallon

* **Quelle est le type des vecteurs hwy, displ et manufacturer ? **
```{r}
class(mpg$hwy)
class(mpg$displ)
class(mpg$manufacturer)

```


* **Combien y-a-t il de ligne et de colonne dans mpg ?**

La data frame contient 234 lignes et 11 variables (colonnes). 


## Exercice 3


Reproduisez le scatterplot ci-dessous entre hwy et displ puis entre hwy et cyl; entre class et drv. Expliquez pourquoi ces graphes ont ces formes.

```{r,echo=TRUE,fig.show='hold',out.width='33%'}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))+
 theme(plot.subtitle = element_text(vjust = 1), 
    plot.caption = element_text(vjust = 1), 
    axis.title = element_text(size = 25), 
    axis.text = element_text(size = 18))
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = cyl))+
    theme(plot.subtitle = element_text(vjust = 1), 
    plot.caption = element_text(vjust = 1), 
    axis.title = element_text(size = 25), 
    axis.text = element_text(size = 18))

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = class, y = drv))+
   theme(plot.subtitle = element_text(vjust = 1), 
    plot.caption = element_text(vjust = 1), 
    axis.title = element_text(size = 25), 
    axis.text = element_text(size = 14))
```

## Exercice 4


 * Dessiner un nuage de points pour chaque esthétique aes(x,y,shape = class ) définit par la colonne `class` pour les couleurs *color*, les formes *shape*, la taille *size*, et la transparence *alpha*.
 
```{r, echo=FALSE, message=FALSE, warning=FALSE,fig.show='hold',out.width='50%'}
 ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class))
  ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class)) 
 
```
```{r, echo=FALSE, message=FALSE, warning=FALSE,fig.show='hold',out.width='50%'}
    ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class)) 
    
    ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class)) 
```

 * Pourquoi il y a des points qui ont disparu de la classe suv dans le graphique où l'on dessine le nuage avec différentes formes de point `aes(x,y,shape=class)` ?
 
 Au-delà de 7 classes, ggplot ne gère plus automatiquement les types de points et de lignes aussi. Il est nécessaire alors d'utiliser la `scale_shape_manual()`
 
  * Que faut il ajouter pour corriger le graphique  ? ([indice](http://www.cookbook-r.com/Graphs/Shapes_and_line_types/) et regardez le message de warning afficher en console)

```{r,echo=T,fig.show='hold',out.width="50%"}
    ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class,fill=class)) 
    ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class,fill=class)) +scale_shape_manual(values=seq(1,7))

```



 
 
 * Quel est le problème dans ce code ?
```{r,eval=FALSE}
 ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy,colour="class"))
```

Le graphique comprend qu'il y a qu'une classe de couleur pour le nuage de point.  

  * Quelle est la différence avec les graphiques précédent et quel est l'impact sur les graphes du code ci-dessous ?
```{r,eval=FALSE}
 ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy),colour="blue")
  
   ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy),size=10)
```

  
 Les caractéristiques du graphe sont spécifiées en dehors de la fonction `aes()`.
 
 **Exercice 5**
 
 
1. *A quoi sert le `.` dans la formule de facet_grid ? (Tester les exemples en dessous)*
```{r, eval = F}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(drv ~ .)

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(. ~ cyl)

```

2. *Quelles sont les avantages et les désavantages d'utiliser les fonctions `facet` par rapport à une esthétique `aes(x,y,color=...)` ?*

```{r,eval=F}
    ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +   facet_wrap(facets = ~ class)

  ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy,color=class)) 

```

Les avantages dépendent de vos données : l'avantage principal de facet est de pouvoir se concentrer sur chaque type de population  de votre échantillon. Si vous avez peu (une dizaine) de sous groupe dans votre échantillon `facet` peut être utilisée. Dans la cas contraire il faut faire attention à la taille de vos graphiques et surtout la visibilité de vos axes qui peuvent devenir illisible en raison du nombre trop important de panneaux générés. 

3.*Quelles sont les différences entre `facet_grid()` et `facet_wrap()` ? (Indice utiliser `?`)*

La fonction `facet_wrap` optimise l'espace du graphe grâce à la possibilité de créer des séquences de panneaux en 2 dimensions alors que `facet_grid` constitue une matrice de panneaux en fonction que d'un critère en 1d.


**Exercice 6**

* *Que font les options `se=FALSE` et `show.legend=FALSE` ?*

```{r,eval=FALSE}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point(show.legend=F) + 
  geom_smooth(se = FALSE,show.legend=FALSE)

```
**se** est le champ des possibles de votre courbe de modélisation statistique à un interval de confiance de 95 %. 

**show.legend** s'il est égal à vraie alors la légende est présente, sinon elle n'est pas sur le graphe.


* *Ces deux graphes sont ils différents ?* 

La position de `aes(x = displ, y = hwy)` permet de synthétiser ton code. 

```{r,eval=FALSE,fig.show='hold',out.width='50%'}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()

ggplot() + 
  geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))
```
* *Refaire les graphes ci-dessous :*

```{r,echo=FALSE,fig.show='hold'}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +geom_smooth() +geom_point()
ggplot(data = mpg, mapping = aes(x = displ, y = hwy))  +geom_smooth(aes(group=drv),se=F) +geom_point()
```

```{r,echo=FALSE,fig.show='hold'}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy,color=drv))  +geom_smooth(se=F) +geom_point()
ggplot(data = mpg, mapping = aes(x = displ, y = hwy))  +geom_smooth(se=F) +geom_point(aes(color=drv))
```

```{r,echo=FALSE,fig.show='hold'}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy))  +geom_smooth(se=F,aes(linetype=drv)) +geom_point(aes(color=drv))
ggplot(data = mpg, mapping = aes(x = displ, y = hwy))  +geom_smooth(se=F,aes(linetype=drv))+geom_point(size = 5, color="white") +geom_point(aes(color=drv))

```


**Exercice 7**
 
 1. *Quel est l'équivalent géométrique de `stat_summary()` ? Modifiez le code ci-dessus en utilisant une fonction `geom_`.*
 
 L'équivalent de `stat_summary` est `geom_point`
 
 2.*Quelle est la différence entre les fonctions `stat_` et `geom_` ? Listez les paires entre les deux genres de fonctions.*

Les fonctions `geom_` définissent les objets de votre graphique à l'instar des fonctions `stat` qui font des transformations .

3. *Quelle est le "bug" de ce graphique? Corrigez le.*

```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = ..prop..,group=1))
```


**Exercice 8**

1. *Quel est le problème avec ce graphique ? Comment pouvez vous l'améliorer ?*

  Utiliser `geom_jitter()`.

```{r}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) + 
  geom_jitter()

```

2. Quels sont les arguments de `geom_jitter()`?

`?geom_jitter()` pour connaître les arguments de `geom_jitter`.


3. Comparer `geom_jitter()` et  `geom_count()` ?

```{r,fig.show='hold',out.width = '50%'}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) + 
  geom_jitter()
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) + 
  geom_count()
```


4. Recréer ces graphiques


```{r,fig.show='hold',out.width = '50%'}
ggplot(data = diamonds, mapping = aes( x= cut,y=depth)) +
  geom_boxplot()
ggplot(data = diamonds, mapping = aes( x= cut,y=depth)) +
  geom_jitter()

```

```{r,fig.show='hold',out.width = '50%'}
ggplot(data = diamonds, mapping = aes( x= cut,y=depth)) +
  geom_violin()

ggplot(data = diamonds, mapping = aes( x= cut,y=depth))+
  geom_jitter(alpha=0.5)+ geom_violin(alpha=0.7)


```

5. A quelles valeurs/métriques correspondent les traits horizontaux de la boîte à moustache ? (Indice utiliser `stat_summary`)

```{r,fig.show='hold',out.width='50%'}
ggplot(data = diamonds, mapping = aes(x=cut,y=depth)) +
geom_boxplot()

ggplot(data = diamonds, mapping = aes(x=cut,y=depth)) +
geom_boxplot()+
stat_summary( color="red", fun.ymin = min,
    fun.ymax = max,
    fun.y = median)
```


**Exercice 9**

1. Dessinez le département et une région de votre choix ?


2. Quelle est la différence entre `coord_map()` et `coord_quickmap()` ? 

Le temps de calcul est plus long avec `coord_map()` car elle n'est pas aussi approximative que`coord_quickmap()`. Ex. :

```{r,fig.show='hold',out.width='33%'}
nz <- map_data("nz")
# Prepare a map of NZ
nzmap <- ggplot(nz, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill = "white", colour = "black")

# Plot it in cartesian coordinates
nzmap +labs(title="cartesian")
# With correct mercator projection
nzmap + coord_map() + labs(title="coord_map")
# With the aspect ratio approximation
nzmap + coord_quickmap()+ labs(title="coord_quickmap")
```


**Exercice 10**

1. Changer le thème du précédent graphes ?

```{r,eval=FALSE}
fr <- map_data("france")

ggplot(fr, aes(long, lat, group = group)) +
  geom_polygon(fill = "white", colour = "black") +
  coord_quickmap()+theme_nothing()
```



